{% extends 'base.html' %}
{% block title %} Confirmação - Bulldog  {% endblock %}

{% block cliente %} {{cliente}} {% endblock %}
{% block login %} {{login}} {% endblock %}
{% block logout %} {{logout}} {% endblock %}

{% block content %}
<div class="container mt-5">
	<main>
		<div id="stepperCheckout" class="d-flex align-items-center justify-content-center mt-4 mb-3 overflow-auto">

			<div class="d-flex">
			  <div id="steppCarrinho" class="d-flex justify-content-between flex-column align-items-center">
				<svg width="36" height="36" viewBox="0 0 23 22" fill="none" xmlns="https://www.w3.org/2000/svg">
				  <path d="M7.09977 17.6C5.88981 17.6 4.91085 18.59 4.91085 19.8C4.91085 21.01 5.88981 22 7.09977 22C8.30973 22 9.2997 21.01 9.2997 19.8C9.2997 18.59 8.30973 17.6 7.09977 17.6ZM0.5 0V2.2H2.69992L6.65979 10.549L5.17484 13.244C4.99885 13.552 4.89985 13.915 4.89985 14.3C4.89985 15.51 5.88981 16.5 7.09977 16.5H20.2993V14.3H7.56176C7.40776 14.3 7.28677 14.179 7.28677 14.025L7.31977 13.893L8.30973 12.1H16.5044C17.3294 12.1 18.0554 11.649 18.4294 10.967L22.3672 3.828C22.458 3.66013 22.5037 3.47158 22.4998 3.28078C22.4959 3.08998 22.4426 2.90346 22.345 2.73943C22.2475 2.5754 22.1091 2.43947 21.9433 2.34492C21.7776 2.25037 21.5901 2.20044 21.3993 2.2H5.13084L4.09688 0H0.5ZM18.0994 17.6C16.8894 17.6 15.9105 18.59 15.9105 19.8C15.9105 21.01 16.8894 22 18.0994 22C19.3094 22 20.2993 21.01 20.2993 19.8C20.2993 18.59 19.3094 17.6 18.0994 17.6Z" fill="#006400"></path>
				</svg>
				<label class="">Carrinho</label>
			  </div>
			  <div class="">
				<svg width="33" height="8" viewBox="0 0 33 8" fill="none" xmlns="https://www.w3.org/2000/svg">
				  <path d="M32.3536 4.35355C32.5488 4.15829 32.5488 3.84171 32.3536 3.64644L29.1716 0.464464C28.9763 0.269201 28.6597 0.269201 28.4645 0.464464C28.2692 0.659726 28.2692 0.976308 28.4645 1.17157L31.2929 4L28.4645 6.82842C28.2692 7.02369 28.2692 7.34027 28.4645 7.53553C28.6597 7.73079 28.9763 7.73079 29.1716 7.53553L32.3536 4.35355ZM4.37114e-08 4.5L32 4.5L32 3.5L-4.37114e-08 3.5L4.37114e-08 4.5Z" fill="#7F858D"></path>
				</svg>
			  </div>
			  <div id="steppConfirmacao" class="d-flex justify-content-between flex-column align-items-center">
				<svg width="36" height="36" viewBox="0 0 14 14" fill="none" xmlns="https://www.w3.org/2000/svg">
				  <path d="M5.1375 7C5.1375 7.47837 5.32696 7.93714 5.6642 8.2754C6.00144 8.61365 6.45884 8.80368 6.93577 8.80368C7.4127 8.80368 7.8701 8.61365 8.20734 8.2754C8.54458 7.93714 8.73404 7.47837 8.73404 7C8.73404 6.52163 8.54458 6.06286 8.20734 5.7246C7.8701 5.38635 7.4127 5.19632 6.93577 5.19632C6.45884 5.19632 6.00144 5.38635 5.6642 5.7246C5.32696 6.06286 5.1375 6.52163 5.1375 7ZM13.9073 6.58451C12.3852 3.36848 10.0843 1.75 7 1.75C3.91404 1.75 1.61482 3.36848 0.0927157 6.58612C0.0316634 6.71579 0 6.85741 0 7.0008C0 7.1442 0.0316634 7.28582 0.0927157 7.41549C1.61482 10.6315 3.91564 12.25 7 12.25C10.086 12.25 12.3852 10.6315 13.9073 7.41388C14.0309 7.15299 14.0309 6.85023 13.9073 6.58451ZM6.93577 9.83436C5.37513 9.83436 4.10992 8.56534 4.10992 7C4.10992 5.43466 5.37513 4.16564 6.93577 4.16564C8.49641 4.16564 9.76162 5.43466 9.76162 7C9.76162 8.56534 8.49641 9.83436 6.93577 9.83436Z" fill="#006400"></path>
				</svg>
				<label class="">Confirmação</label>
			  </div>
			  <div class="">
				  <svg width="33" height="8" viewBox="0 0 33 8" fill="none" xmlns="https://www.w3.org/2000/svg">
					<path d="M32.3536 4.35355C32.5488 4.15829 32.5488 3.84171 32.3536 3.64644L29.1716 0.464464C28.9763 0.269201 28.6597 0.269201 28.4645 0.464464C28.2692 0.659726 28.2692 0.976308 28.4645 1.17157L31.2929 4L28.4645 6.82842C28.2692 7.02369 28.2692 7.34027 28.4645 7.53553C28.6597 7.73079 28.9763 7.73079 29.1716 7.53553L32.3536 4.35355ZM4.37114e-08 4.5L32 4.5L32 3.5L-4.37114e-08 3.5L4.37114e-08 4.5Z" fill="#7F858D"></path>
				  </svg>
				</div>
				<div id="steppPagamento" class="d-flex justify-content-between flex-column align-items-center">
				  <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="https://www.w3.org/2000/svg"><path d="M32.4 3H3.6C1.602 3 0.018 4.66875 0.018 6.75L0 29.25C0 31.3312 1.602 33 3.6 33H32.4C34.398 33 36 31.3312 36 29.25V6.75C36 4.66875 34.398 3 32.4 3ZM32.4 29.25H3.6V18H32.4V29.25ZM32.4 10.5H3.6V6.75H32.4V10.5Z" fill="#DEE0E4"></path>
				  </svg>
				  <label class="">Pagamento</label>
				</div>
				
				<div class="">
				  <svg width="33" height="8" viewBox="0 0 33 8" fill="none" xmlns="https://www.w3.org/2000/svg"><path d="M32.3536 4.35355C32.5488 4.15829 32.5488 3.84171 32.3536 3.64644L29.1716 0.464464C28.9763 0.269201 28.6597 0.269201 28.4645 0.464464C28.2692 0.659726 28.2692 0.976308 28.4645 1.17157L31.2929 4L28.4645 6.82842C28.2692 7.02369 28.2692 7.34027 28.4645 7.53553C28.6597 7.73079 28.9763 7.73079 29.1716 7.53553L32.3536 4.35355ZM4.37114e-08 4.5L32 4.5L32 3.5L-4.37114e-08 3.5L4.37114e-08 4.5Z" fill="#7F858D"></path></svg>
				</div>
				<div id="steppConclusao" class="d-flex justify-content-between flex-column align-items-center">
				  <svg width="28" viewBox="0 0 28 28" fill="none" xmlns="https://www.w3.org/2000/svg">
					<path fill-rule="evenodd" clip-rule="evenodd" d="M28 14C28 21.732 21.732 28 14 28C6.26801 28 0 21.732 0 14C0 6.26801 6.26801 0 14 0C21.732 0 28 6.26801 28 14ZM5.83333 15.3242L10.8182 20.6111L22.1667 8.57484L20.6818 7L10.8182 17.4614L7.31818 13.7493L5.83333 15.3242Z" fill="#DEE0E4"></path>
				  </svg>
				  <label class="">Conclusão</label>
				</div>
			  </div>
			</div>
			
		<div class="row g-5 p-2">
			
			<div class=" col-md-10 col-lg-10 col-sm-10 col-xs-10 mx-auto bg-light rounded shadow">
				
			<form target="_blank" id="finalizarpedido" method="POST" action="/finalizarPedido/">
				{% csrf_token %}

			<input required readonly type="hidden" value="{{user.id}}" name="idcliente">
			<input required readonly type="hidden" value="{{endereco.id_endereco}}" name="enderecoentrega">
			<input required readonly type="hidden" value="{{idfrete}}" name="idfrete">	
			<input type="hidden" name="description" id="description" />
			<input required type="hidden" name="pagamentoescolhido" id="pagamentoescolhido" value=""/>


			<div class="row g-3 mt-3">

				<h4 class="text-center d-flex justify-content-between align-items-center mb-3 mt-3">
					<span class="text-success text-center">CONFIRME SEU PEDIDO</span>

					<span class="badge bg-success rounded-pill">{{qtd}}</span>

				</h4>

				<ul class="list-group mb-3">
					<h4 class="mb-3 mt-3 text-center">Itens</h4>
					{% for item in items%}
					<input required readonly type="hidden" value="{{item.var.id_variacao}},{{item.qtdvar}}" name="items">
					
					<li class="list-group-item d-flex justify-content-between lh-sm">
						<div>
							<h6 class="my-0">{{item.var.id_produto.nome}}</h6>
							<small class="text-muted">{{item.var.nome}}</small>
						</div>
						<div>
							<span class="text-muted text-end">{{item.qtdvar}} und x</span>
							<span class="text-muted">R$ {{item.var.preco}}0</span>
							<span> - </span>
							<span class="fw-bold ">R$ {{item.subtotal}}0</span>
						</div>
						
					</li>
					
					
					{% endfor %}

					<input id="codpromo" readonly type="hidden" value="" name="codpromo">
					
									
					<li id="divdesconto" class="list-group-item d-flex justify-content-between  d-none">
						<div class="text-success ">
							<h6 class="my-0">Código promocional</h6>
							<small id="nomecupom" class="text-muted"></small>
						</div>
						<div>
						<span id="porcentagem" class="text-muted text-end"></span>
						<span> - </span>
						<span style="color: green;" id="descontoaplicado" class="fw-bold"></span>
					</div>
					</li>
					<li class="list-group-item text-dark d-flex justify-content-between fw-bold fs-6">
						<span >Total </span>
						<span id="totprod"> R$ {{totalprodutos}}0</span> 
					</li>
					
						
				

				</ul>

				
				<h4 class="mb-3 mt-3 text-center">Envio</h4>

				<div class="col-12 mb-5 ">
								        
					<div class="card w-100 text-dark ">				
							<div class="card-body w-100">
								<h5 class="card-title">{{opcao}}</h5>
								<p class="card-text">Valor: R$ {{valor}} - Prazo: {{prazo}} dias úteis</p>
								
		
							</div>
					</div>					
					
		
				</div>
				<ul class="list-group mb-3">
				<li class="list-group-item text-success d-flex justify-content-between fw-bold fs-5">
					<span >Total produtos + frete</span>
					<span id="totalprodmaisfrete">R$ {{totalpedido}}</span>
				</li>


				<li class="list-group-item text-success d-flex justify-content-between border-0 fw-bold fs-5 mt-5">
					<card class="w-100">
						<div class="input-group">
						  <input minlength="1" id="codigopromo" type="text" class="form-control" placeholder="Código promocional">
						  <button id="resgatar" type="button" class="btn btn-secondary">Resgatar</button>
						</div>
					</card>
				</li>					   
				<li class="list-group-item text-success d-flex justify-content-between border-0 fw-bold fs-5 mb-3">
				  <img id="loaderfrete2" style='max-width: 5%;' class='mx-auto mt-3 mb-3 d-none' src='../../static/images/1487.gif'> 
				  <h6 id="valordesc" class="d-none mx-auto w-100 text-center"></h6>
				</li>

				<h4 class="mb-3 mt-3 text-center">Endereço de entrega</h4>

				<div class="col-12 mb-5">
					
			        
					<div class="card w-100 text-dark ">				
							<div class="card-body w-100">
								<h5 class="card-title">{{endereco.rua}}, {{endereco.numero}}</h5>
								<p class="card-text"><strong>CEP: </strong> {{endereco.cep}},
								{{endereco.bairro}}, {{endereco.cidade}}, {{endereco.estado}}<br>
								{{endereco.complemento1}} {{endereco.complemento2}}
								</p>
		
							</div>
					</div>					
					
		
				</div>

				<h4 class="mb-3 mt-3 text-center">Forma de pagamento</h4>

				<div class=" col-12 mb-5">

					<div class="form-check mt-3 mb-3">
						<input required class="form-check-input" type="radio" id="radiocredito" name="radiopag">
						<label class="form-check-label w-100" for="radioCredito">
						<div class="card w-100 text-dark ">				
								<div class="card-body w-100">
									<h5 class="card-title">Cartão de crédito</h5>
									<p class="card-text">R$ {{totalpedido}}0 em até 3x sem juros ou até 12x com juros<p>
			
								</div>
						</div>	
						</label>	
					</div>
					
					<div class="form-check mt-3 mb-3">
					<input required class="form-check-input" type="radio" id="radiooutros" name="radiopag">
					<label class="form-check-label w-100" for="radioPix">
					<div class="card w-100 text-dark ">				
							<div class="card-body w-100">
								<h5 class="card-title">PIX, Boleto ou Pagamento na loterica</h5>
								<p class="card-text">R$ {{totalpedido}}0<p>
		
							</div>
					</div>	
					</label>	
					</div>	
					
					

					
				
				<li style="font-size: x-small;" class="list-group-item text-dark fw-bolder ">*Ao finalizar o pedido, você concorda com os valores descritos acima, e com os dados fornecidos para entrega. Nenhuma alteração no pedido poderá ser efetuada</li>



				


			</ul>


			</div>
					<button id="enviarbtn" class="mb-5 w-100 btn btn-success btn-lg" type="submit">FINALIZAR PEDIDO</button> 
					
				</form>
			</div>

		</div>

	</main>

	
</div>

<div style="height: 80px;"></div>

{% endblock %}

{% block script %}


<script>  

	$('#resgatar').click(function() {


	$('#loaderfrete2').removeClass('d-none')
	var codigo = document.getElementById('codigopromo').value
	
	  $.ajax({
		type: 'POST',
		url: "{% url 'desconto' %}",
		data: { 'valor': codigo },
		success: function (response) {
  
		$('#loaderfrete2').addClass('d-none')
		$('#valordesc').removeClass('d-none')
		
		if (response.msg == 'Cupom inválido ou já foi utilizado!'){
  
		$('#descontodocupom').addClass('d-none')  
		$('#valordesc').addClass('alert alert-danger')
		$('#valordesc').html(' '+response.msg)
		
  
  
		}else{

		$('#valordesc').removeClass('alert-danger')
		$('#valordesc').addClass('alert alert-success text-center')
		$('#valordesc').html('Desconto aplicado de '+response.msg+"%")
		$('#divdesconto').removeClass('d-none')
		$('#nomecupom').removeClass('d-none')
		$('#nomecupom').html(codigo)
		$('#porcentagem').html(' '+response.msg+"% de desconto")
	   
		var total = simpleCart.total()
		var desconto = total*(response.msg/100)
		var totalcomdesconto = total - (total*(response.msg/100))
		var totalpedido = parseFloat('{{totalpedido}}', 10)
		var valorfinal = totalpedido-desconto
		

  
		$('#descontoaplicado').html('R$ '+desconto.toFixed(2))
		$('#totprod').html('R$ '+totalcomdesconto.toFixed(2))
		$('#totalprodmaisfrete').html('R$ '+valorfinal.toFixed(2))
		$('#resgatar').addClass('d-none')
		$('#codigopromo').prop('readonly', true)
		
		$('#codpromo').val(codigo)
		

	  }
  
		},
		error: function (response) {

		$('#descontodocupom').addClass('d-none')
		$('#loaderfrete2').addClass('d-none')
		$('#divdesconto').removeClass('d-none')
		$('#valordesc').addClass('alert alert-danger text-center')
		$('#valordesc').html('Cupom inválido ou já foi utilizado!')		
	}


	  })
  



	// <li id="descontodocupom" class="text-success d-none list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
    //               Desconto cupom aplicado:
    //               <span id="descontodocupom2" class="fw-bold"></span>
    //             </li>

  
  
	});
  </script>


<script>

$('#radiocredito').click(function () {

$('#pagamentoescolhido').val(1)

});

$('#radiooutros').click(function () {

$('#pagamentoescolhido').val(2)

});

$('#finalizarpedido').submit(function (e){
	e.preventDefault(); // dont submit multiple times
  this.submit(); // use native js submit

  setTimeout(function(){
	  
	localStorage.removeItem('simpleCart_items')
    window.location.href='{% url "index" %}'

  });
	
    
	

});

</script>

{% endblock script %}